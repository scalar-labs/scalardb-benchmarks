# ScalarDB ベンチマークツール: アクティブコンテキスト

## 現在の作業状況

ScalarDBベンチマークツールは、データベースのパフォーマンスを測定するために設計された一連のツールです。現在、プロジェクトには以下のベンチマークが実装されています：
- TPC-C ベンチマーク（完全実装）
- YCSB ベンチマーク（ワークロードA、C、F）
- マルチストレージYCSB ベンチマーク（ワークロードC、F）
- マルチユーザーYCSB ベンチマーク（ワークロードC）

プロジェクトは本格的な運用段階にあり、各ベンチマークが独立したモジュールとして安定的に動作します。現在の主要な価値提供は、ScalarDBの性能評価における業界標準ベンチマークの実行と、特にマルチユーザー環境でのスケーラビリティ評価機能です。

## 最近の変更点

プロジェクトの公開リポジトリには、以下の機能が実装されています：
- ベンチマーク実行のための基本的なフレームワーク構造
- TPC-Cの完全な実装
- YCSBの3つのワークロードパターン（A、C、F）の実装
- マルチストレージ環境でのYCSBベンチマーク実行サポート
- 柔軟な設定オプション

最近追加・更新された機能：
- READMEの中央化されたScalarDBドキュメントリポジトリへの参照
- 適切なエラーハンドリングの実装
- パフォーマンス最適化の改善
- **マルチユーザーモードの実装**
  - 複数ScalarDBユーザーによる並列アクセスのベンチマーク
  - ユーザー作成と権限管理機能
  - ユーザーごとの固有キー範囲によるアクセス分散

## 次のステップ

### 短期的な改善点（緊急度：中〜高）
1. **ABACマルチユーザーベンチマークの実装**（新規追加）
   - MultiUserAbacWorkloadCクラスの作成
   - ABAC設定対応のローダーの実装
   - 属性ベースアクセス制御による性能影響の測定機能
2. マルチユーザーモード拡張（他のワークロードA、Fへの適用）
3. より詳細なパフォーマンスメトリクスの収集と分析機能
4. 他のYCSBワークロード（B、D、E）の実装検討
5. 異なるデータベースバックエンドでの検証とテストケース拡充
6. ユーザードキュメンテーションとベストプラクティスガイドの改善

### 中長期的な改善点（継続的な価値向上）
1. より新しいJDKバージョンのサポート（JDK 11, 17）
2. カスタムワークロードの定義機能の追加
3. グラフィカルな結果レポート機能とダッシュボード
4. 継続的インテグレーション環境での自動ベンチマーク実行
5. クラウドネイティブな実行環境への対応

## アクティブな意思決定と考慮事項

### パフォーマンス測定の正確性
- トランザクション実行時間の測定方法の標準化
- リトライによる影響を考慮したレポーティング
- ウォームアップ期間（ramp_for_sec）の適切な設定の推奨

### ワークロードの設計
- 実際のアプリケーションパターンを反映したワークロード構成
- 複数のストレージを使用するアプリケーションのテスト方法
- **マルチユーザー環境におけるパフォーマンス特性の評価**
- **ユーザー数とキー範囲分割方法の最適化**

### 技術的な負債
- JDK 8依存による将来的な互換性の課題
- エラー処理とリトライロジックの改善余地
- テスト網羅率の向上

## 学びとプロジェクトの洞察

### ベンチマーク設計の知見
- データベースのパフォーマンス特性は、ワークロードパターンによって大きく異なる
- トランザクションの分離レベルとスループットのトレードオフの重要性
- 適切なインデックス戦略がパフォーマンスに与える影響
- **ユーザー数増加に対するスケーラビリティの分析手法**

### ScalarDB固有の特性
- マルチストレージ環境でのトランザクション処理の複雑さ
- 競合解決メカニズムとバックオフ戦略の効果
- 様々なバックエンドデータベースでの挙動の違い
- **複数ユーザーによる並列アクセス時の認証・権限管理の影響**

### ユーザーフィードバック
- より簡単なセットアッププロセスへの要望
- クラウド環境での実行に関するガイダンスの必要性
- 標準的なベンチマーク結果の参照データへのアクセス
- **マルチユーザー環境でのパフォーマンス影響の評価ニーズ**

## 重要なパターンと設定

### 推奨設定
- **適切なワークロード選択：**
  - トランザクション処理の評価にはTPC-C
  - 基本的なCRUD操作のスケーラビリティ評価にはYCSB
  - マルチユーザー環境の評価にはマルチユーザーYCSB
  - 複数ストレージ環境の評価にはマルチストレージYCSB
- **パフォーマンステスト時の推奨パラメータ：**
  - 十分な`run_for_sec`（最低300秒、本格評価は600秒以上）
  - 適切な`ramp_for_sec`でJVMウォームアップを確保（最低60秒）
  - 環境に応じた`concurrency`と`user_count`の調整
  - リソース監視との組み合わせ（CPU、メモリ、ディスクI/O）
- **設定ファイルの管理：**
  - 環境ごとの設定ファイルのバージョン管理
  - 適切な接続プール設定とタイムアウト値

### トラブルシューティングパターン
- トランザクション競合率が高い場合の`backoff`値の調整
- メモリ不足エラーが発生した場合のJVMヒープサイズの増加
- データロード時の`load_concurrency`とバッチサイズの調整
- **マルチユーザーモード使用時のユーザー作成エラーの確認**

### ベンチマーク実行戦略
1. 小規模な設定での初期テスト実行
2. システムリソースのモニタリング
3. ボトルネックの特定（CPU、メモリ、ネットワーク、ディスクI/O）
4. パラメータ調整と再テスト
5. スケールを拡大した本番的なテスト実行
6. **ユーザー数を変化させた比較テストの実施**
